## 概述

AutoCoder Nano 是一款轻量级的编码助手, 利用大型语言模型（LLMs）帮助开发者编写, 理解和修改代码。

它提供了一个交互式命令行界面，支持在软件开发场景中与LLMs互动，具备代码生成, 文件管理和上下文代码理解等功能。

本概述介绍了 AutoCoder Nano 的用途, 架构和核心组件。如需了解更多子系统的详细信息，请参阅相关页面，例如

- 命令行界面
- LLM集成
- RAG系统

### 1.什么是 AutoCoder Nano？

AutoCoder Nano 是 Auto-Coder 生态系统的简化版本，设计轻量且依赖极少。它旨在通过提供增强AI功能的命令行界面，弥合自然语言指令与代码修改之间的鸿沟。
 
Auto-Coder 主社区[点击跳转](https://github.com/allwefantasy/auto-coder)

AutoCoder Nano 的主要特点：

- 轻量级：依赖极少，代码库精简 
- 交互式：支持丰富补全和建议的命令行界面 
- AI驱动：集成多种大型语言模型 
- 上下文感知：利用文件索引和检索实现上下文理解 
- 多功能：支持多种项目类型和编程语言

### 2.系统架构

AutoCoder Nano 采用模块化架构，以命令行界面为核心，连接多个子系统。

#### 2.1.高级架构图

### 3.核心组件

#### 3.1.命令行界面（CLI）

CLI 是用户与 AutoCoder Nano 交互的主要入口，负责解析用户命令, 提供自动补全并显示响应。

主要功能：

- 命令解析与补全 
- 文件和符号建议 
- 响应内容的富文本渲染 
- 交互式会话管理

CLI 支持多种命令类别：

| 命令类别     | 示例命令                                         | 用途                  |
|----------|----------------------------------------------|---------------------|
| **对话**   | `/chat`, `/coding`                           | 与LLM交互，处理通用查询或代码生成  |
| **文件管理** | `/add_files`, `/remove_files`, `/list_files` | 管理当前上下文中的活动文件       |
| **配置**   | `/conf`, `/mode`                             | 配置系统设置和行为           |
| **模型管理** | `/models /add_model`, `/models /list`        | 管理LLM集成设置           |
| **索引**   | `/index/build`, `/index/query`               | 构建和查询代码索引           |
| **工具**   | `/help`, `/shell`, `/exit`                   | 获取帮助、执行Shell命令或退出应用 |


#### 3.2.内存系统

AutoCoder Nano 使用内存字典存储以下状态：

- 对话历史, 即与大模型 `/chat` 的历史
- 活动文件及文件组 
- 配置设置 
- 模型配置 
- 目录排除设置

```python
memory = {
    "conversation": [],  # 对话历史
    "current_files": {"files": [], "groups": {}},  # 文件管理
    "conf": {  # 配置设置
        "auto_merge": "editblock",
        "chat_model": "",
        "code_model": "",
    },
    "exclude_dirs": [],  # 目录排除设置
    "mode": "normal",  # 新增mode字段,默认为normal模式
    "models": {}  # 模型配置 
}
```

内存系统支持会话间持久化，确保复杂项目的连续性。


#### 3.3.项目管理

AutoCoder Nano 支持多种项目类型, 并提供针对性支持:

- Python项目: 处理模块、导入和结构 
- TypeScript项目: 支持TypeScript/JavaScript文件及依赖 
- 自定义项目: 基于文件扩展名的通用支持

项目管理子系统负责理解代码库结构, 识别相关文件, 并为LLM提供适当的上下文。

#### 3.4.LLM集成

LLM集成子系统通过以下方式连接 AutoCoder Nano 与多种大型语言模型：

- 模型配置与选择 
- API通信 
- 响应处理 
- Token管理

AutoCoder Nano 支持为聊天/索引和代码生成配置不同模型，以优化任务性能。


### 4.用户工作流

#### 4.1.项目初始化与配置

**代码生成流程**

AutoCoder Nano 的代码生成流程如下：

- 用户通过 `/coding` [请求] 发起代码生成请求 
- 系统从活动文件中收集上下文 or 通过索引自动获取上下文
- 将上下文和请求发送至配置的LLM 
- 生成的代码呈现给用户 
- 修改可应用于代码库 
- 可选的Git集成支持版本控制

**文件管理**

文件管理包括：

- 查找符合特定模式的文件 
- 从处理中排除指定目录 
- 计算文件哈希以检测变更

AutoCoder Nano 提供两种文件管理方式：

- 自动模式: 系统根据查询自动识别相关文件 
- 手动模式: 用户显式管理活动文件

文件分组功能允许用户为特定任务组织相关文件:

```bash
coding@auto-coder.nano:~$ /add_files /group /add frontend  
coding@auto-coder.nano:~$ /add_files /group /add backend  
coding@auto-coder.nano:~$ /add_files /group frontend  
```

**自然语言编程**

AutoCoder Nano 提供自然语言模式以生成和执行脚本：

1. 通过 /mode auto_detect 或 Ctrl+K 切换模式 
2. 输入自然语言指令 
3. 系统生成对应脚本 
4. 用户可审核并执行脚本

此功能弥合了自然语言指令与可执行命令之间的差距。


### 5.代码索引与检索

索引管理提供：

- 构建并维护项目中代码实体的索引 
  - 索引即提取代码实体中的函数, 类, 变量并分析其用途
  - 首次索引即全量代码索引, 后续索引为增量索引
- 根据需求查询索引以查找相关上下文
  - 基于依赖关系检索关联文件
  - 识别相关文件以优化上下文

索引系统实现了更精准, 高效的代码理解与生成。


### 6.总结

AutoCoder Nano 通过命令行界面提供轻量级, 多功能的AI辅助编码工具。通过将LLM与文件管理, 代码索引和上下文理解相结合, 它实现了自然语言指令与代码修改的无缝衔接。

主要优势:

- 安装简便, 依赖极少 
- 支持多种编程语言和项目类型 
- 灵活的配置和模型管理 
- 上下文感知的代码理解与生成 
- 自然语言编程能力